//>>built
define(["dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/io-query","esri/kernel","esri/config","esri/sniff"],function(f,p,m,n,q,r,s){var e={},l=r.defaults.io,k=window.location.protocol;"file:"===k&&(k="http:");e.urlToObject=function(a){var b=a.indexOf("?");return-1===b?{path:a,query:null}:{path:a.substring(0,b),query:n.queryToObject(a.substring(b+1))}};e.getProxyUrl=function(a,b){var c=f.isString(a)?0===f.trim(a).toLowerCase().indexOf("https:"):a,d=l.proxyUrl,h,g;if(f.isString(a)&&(g=e.getProxyRule(a)))d=
g.proxyUrl;if(!d)throw console.log("esri.config.defaults.io.proxyUrl is not set."),Error("esri.config.defaults.io.proxyUrl is not set.");c&&(!1!==b&&0!==window.location.href.toLowerCase().indexOf("https:"))&&(c=d,0!==c.toLowerCase().indexOf("http")&&(c=e.getAbsoluteUrl(c)),c=c.replace(/^http:/i,"https:"),e.canUseXhr(c)&&(d=c,h=1));d=e.urlToObject(d);d._xo=h;return d};e.addProxy=function(a){var b=e.getProxyRule(a),c;b?c=e.urlToObject(b.proxyUrl):l.alwaysUseProxy&&(c=e.getProxyUrl());c&&(b=e.urlToObject(a),
a=c.path+"?"+b.path,(c=n.objectToQuery(f.mixin(c.query||{},b.query)))&&(a+="?"+c));return a};e.addProxyRule=function(a){var b=a.urlPrefix=e.urlToObject(a.urlPrefix).path.replace(/([^\/])$/,"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),c=l.proxyRules,d,h=c.length,g,f=h;for(d=0;d<h;d++)if(g=c[d].urlPrefix,0===b.indexOf(g)){if(b.length===g)return-1;f=d;break}else 0===g.indexOf(b)&&(f=d+1);c.splice(f,0,a);return f};e.getProxyRule=function(a){var b=l.proxyRules,c=b.length,d=e.urlToObject(a).path.replace(/([^\/])$/,
"$1/").replace(/^https?:\/\//ig,"").toLowerCase(),f;for(a=0;a<c;a++)if(0===d.indexOf(b[a].urlPrefix)){f=b[a];break}return f};e.hasSameOrigin=function(a,b,c){a=a.toLowerCase();b=b.toLowerCase();var d=window.location.href.toLowerCase();a=0===a.indexOf("http")?new m(a):d=new m(d);b=0===b.indexOf("http")?new m(b):f.isString(d)?new m(d):d;return(c||a.scheme===b.scheme)&&a.host===b.host&&a.port===b.port};e.canUseXhr=function(a,b){var c=!1,d=e.hasSameOrigin,h=l.corsEnabledServers,g,k=-1;s("esri-cors")&&
(h&&h.length)&&(c=p.some(h,function(b,c){g=0!==f.trim(b).toLowerCase().indexOf("http");return d(a,g?"http://"+b:b)||g&&d(a,"https://"+b)?(k=c,!0):!1}));return b?k:c};e.getAbsoluteUrl=function(a){return f.isString(a)&&-1===a.indexOf("http://")&&-1===a.indexOf("https://")?0===a.indexOf("//")?k+a:0===a.indexOf("/")?k+"//"+window.location.host+a:q._appBaseUrl+a:a};e.fixUrl=function(a){/^\/\//i.test(a)&&(a=k+a);return a=a.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")};return e});