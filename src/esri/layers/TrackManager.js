//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(m,r,l,s,t,n,p,q){return m(null,{declaredClass:"esri.layers._TrackManager",constructor:function(a){this.layer=a;this.trackMap={}},initialize:function(a){this.map=a;var b=this.layer,d=b._getRenderer(),d=d&&d.trackRenderer;if("esriGeometryPoint"===b.geometryType){var c=this.container=new q._GraphicsLayer({id:b.id+"_tracks",_child:!0});c.loaded=
!0;c.onLoad(c);c._setMap(a,b._div);c.setRenderer(d)}},addFeatures:function(a){var b,d=this.trackMap,c=this.layer,e=c._trackIdField,f,g;l.forEach(a,function(a){f=a.attributes;b=f[e];g=d[b]=d[b]||[];g.push(a)});var h=c._startTimeField,k=c.objectIdField;a=function(a,b){var d=a.attributes[h],c=b.attributes[h];return d===c?a.attributes[k]<b.attributes[k]?-1:1:d<c?-1:1};for(b in d)d[b].sort(a)},drawTracks:function(){var a=this.container;if(a){var b=this.trackMap,d=this.map.spatialReference,c,e,f,g,h,k=
this.layer._trackIdField;for(c in b){e=b[c];f=[];for(g=e.length-1;0<=g;g--)(h=e[g].geometry)&&f.push([h.x,h.y]);e={};e[k]=c;0<f.length&&a.add(new n(new p({paths:[f],spatialReference:d}),null,e))}}},moveLatestToFront:function(){l.forEach(this.getLatestObservations(),function(a){var b=a._shape;b&&b._moveToFront();this._repaint(a,null,!0)},this.layer)},getLatestObservations:function(){var a=[],b=this.layer._getRenderer(),d=this.trackMap,c;if(!b.latestObservationRenderer)return a;for(c in d)b=d[c],a.push(b[b.length-
1]);return a},clearTracks:function(){var a=this.getLatestObservations();this.trackMap={};var b=this.container;b&&b.clear();l.forEach(a,function(a){this._repaint(a,null,!0)},this.layer)},isLatestObservation:function(a){var b=this.trackMap[a.attributes[this.layer._trackIdField]];return b?b[b.length-1]===a:!1},destroy:function(){var a=this.container;a&&(a.clear(),a._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}})});